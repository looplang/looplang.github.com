<!DOCTYPE HTML>
<html>
<head>
  <title>loop documentation</title>

  <link rel="stylesheet" href="../main.css">
  <script type="text/javascript" src="../js/jquery-1.7.1.min.js"></script>
  <script type="text/javascript" src="../js/main.js"></script>
</head>
<body>
<header>
  <h1>loop</h1>
  <nav>
    <a href="/about">About</a>
    <a href="/#get-loop">Get Loop</a>
    <a>Documentation</a>
    <a href="/faq">FAQ</a>
    <a href="https://groups.google.com/group/looplang">Mailing List</a>
  </nav>
</header>
<section id="main">
  <blockquote>
    manual
  </blockquote>

  <div>
    <ul class="outline">
      <li><a name="#introduction">Introduction</a>
        <ul>
          <li><a name="#get-loop">Getting started</a></li>
          <li><a name="#first-loop">My first loop</a></li>
          <li><a name="#evaluation">Evaluation</a></li>
          <li><a name="#prog-structure">Program structure</a></li>
        </ul>
      </li>
      <li><a name="#data-structures">Data structures</a>
        <ul>
          <li><a name="#lists">Lists & sets</a></li>
          <li><a name="#maps">Maps</a></li>
          <li><a name="#trees">Trees</a></li>
        </ul>
      </li>
      <li><a name="#basic-exprs">Basic expressions</a>
        <ul>
          <li><a name="#strings">Strings</a></li>
          <li><a name="#numbers">Numbers</a></li>
          <li><a name="#operators">Operators</a></li>
          <li><a name="#new-objects">Navigating Objects</a></li>
          <li><a name="#if-then-else">If/Then/Else</a></li>
          <li><a name="#list-comp">List comprehension</a></li>
          <li><a name="#list-filter">List filtering</a></li>
          <li><a name="#list-slices">List slices</a></li>
          <li><a name="#null-safety">Null-safety</a></li>
        </ul>
      </li>
      <li><a name="#functions">Functions</a>
        <ul>
          <li><a name="#simple-funcs">Simple functions</a></li>
          <li><a name="#recursion">Recursion</a></li>
          <li><a name="#where-block">Local scope</a></li>
          <li><a name="#closures">Closures</a></li>
          <li><a name="#call-as-method">Call as method</a></li>
        </ul>
      </li>
      <li><a name="#pattern-funcs">Pattern matching functions</a>
        <ul>
          <li><a name="#pattern-literals">Literals</a></li>
          <li><a name="#pattern-lists">Lists</a></li>
          <li><a name="#pattern-strings">Strings & Regexes</a></li>
          <li><a name="#pattern-objects">Objects</a></li>
          <li><a name="#pattern-guards">Guards</a></li>
          <li><a name="#pattern-examples">Examples</a></li>
        </ul>
      </li>
      <li><a name="#cflow">Control flow</a>
        <ul>
          <li><a name="#exceptions">Exceptions</a></li>
          <li><a name="#except-handling">Handler functions</a></li>
        </ul>
      </li>
      <li><a name="#classes-objects">Classes & objects</a>
        <ul>
          <li><a name="#objects">Defaults</a></li>
          <li><a name="#classes">Constructors</a></li>
          <li><a name="#immutability">Immutability</a></li>
          <li><a name="#manipulating-objects">Manipulating objects</a></li>
          <li><a name="#duck-typing">Duck typing</a></li>
        </ul>
      </li>
      <li><a name="#modules">Modules & Import</a>
        <ul>
          <li><a name="#imports">Importing</a></li>
          <li><a name="#require-as">Import collisions</a></li>
          <li><a name="#basic-mods">First module</a></li>
          <li><a name="#core-libs">Bundled modules</a></li>
          <li><a name="#hierarchical-mods">Hierarchical modules</a></li>
        </ul>
      </li>
      <li><a name="#java-interop">Java Interop</a>
        <ul>
          <li><a name="#java-instance">Calling instance methods</a></li>
          <li><a name="#java-static">Calling static methods</a></li>
          <li><a name="#java-props">Getters & Setters</a></li>
          <li><a name="#java-types">Type references</a></li>
        </ul>
      </li>
      <li><a name="#concurrency">Concurrency</a>
        <ul>
          <li><a name="#message-passing">Channels & Message Passing</a></li>
          <li><a name="#serial-channels">Serialized channels</a></li>
          <li><a name="#conc-channels">Concurrent channels</a></li>
          <li><a name="#channel-memory">Channel memory</a></li>
          <li><a name="#stm">Shared memory & transactions</a></li>
        </ul>
      </li>
    </ul>
  </div>

  <h2>Introduction</h2>
  <h3>Getting started</h3>
  <p>
    you will need java 1.6 or higher already installed. check if you have it by running:
  </p>
  <div class="code">
<pre>$ ~java -version~
java version "1.6.0_31"
Java(TM) SE Runtime Environment
Java HotSpot(TM) 64-Bit Server VM</pre>
  </div>

  <p>
    download and unzip the <a href="#">loop distribution</a>. from the directory you unzipped
    it into, run:
  </p>
  <div class="code">
<pre>$ ~./loop~</pre>
  </div>
  <p>
    this will bring up the loop shell, from where you can execute simple loop expressions
    and functions
  </p>
  <div class="code">
<pre>loOp (http://looplang.org)
     by Dhanji R. Prasanna

>> ~1 + 2 + 4~
7
>> ~alert('hi there')~
>> ~:help~
</pre>
  </div>

  <h3>My first loop</h3>
  <p>
    like all other decent things, loop programs are stored in files. you can recognize
    a loop program file by its extension <i>.loop</i>.
    they can be executed either from the shell (using :run) or directly from the command line:
  </p>
  <div class="code">
<pre>$ ~./loop myfirst.loop~
hello there
</pre>
  </div>

  <p>
    this snippet above looks for a program file called <i>myfirst.loop</i> and executes it.
    you can create and save this file in any text editor, it contains nothing more than the following:
  </p>
  <div class="code">
<pre>print('hello there')</pre>
  </div>
  <p>
    give this a try now. you can print other things too:
  </p>

  <div class="code">
    <pre>print(1 + 2)
print(5 * 50 / 44)
print(new java.util.Date())</pre>
  </div>
  <p>
    these are called 'free expressions' and they may appear anywhere inside a loop function or
    program. specifically, the function print is being called with different values.

    as you will learn soon, everything in loop is designated in terms of functions
    and values.
  </p>


  <h3>Evaluation</h3>
  <p>
    so far you have seen how small computations and function calls work in loop. these are known
    as <i>expressions</i>, and form the basic building blocks of all programs.
  </p>
  <div class="code">
<pre>$ ~./loop myfirst.loop~
hello there
</pre>
  </div>

  <p>
    while free expressions in a file are useful for writing quick scripts, if you write a larger
    application (consisting of many .loop files) you will want to define a clear entry point for
    your app. Loop uses the C convention of using a function called <code>main</code>, which is
    called by the runtime if present:
  </p>
  <div class="code">
<pre>main ->
  print('hello there')</pre>
  </div>
  <p>
    give this a try now. you should see the same result. this is the first function we've seen. all
    functions are declared with a name followed by a <code>-></code> arrow. any expressions that
    appear below, belong to the function and will execute when the function is called.
    <code>main</code> can optionally take arguments:
  </p>

  <div class="code">
<pre>main(args) ->
  print(args)</pre>
  </div>
  <p>
    which are passed in via the command line:
  </p>
  <div class="code">
<pre>$ ~./loop echo.loop ahoyhoy~
[ahoyhoy]
</pre>
  </div>
  <p>
    note that this prints a list of arguments, denoted by the brackets - <code>[]</code>. we'll
    see more about lists and functions in the following sections.
  </p>

  <h3>Program structure</h3>
  <p>
    loop files are organized into a formal structure which is enforced by the program parser. it
    is fairly straightforward:
  </p>
  <div class="code">
<pre>
module declaration

import declarations

functions & type definitions

free expressions
</pre>
  </div>
  <p>
    here's an example of a loop program
  </p>

  <div class="code">
<pre>
module mymodule

require other.mod
require yet.another

class Pair ->
  left: 0
  right: 0

main ->
  new Pair(1, 2)   # comments may appear anywhere


# free expressions must appear last
print('mymodule is go!')
</pre>
  </div>

  <p>
    a module declaration appears at the top (usually this is the name of the loop file without the
    .loop extension), followed by <code>require</code> statements that denote imports of other
    modules or java types.
    loop type and function definitions come next and may be mixed,
    but free expressions are always last.
  </p>
  <p>
    note: free expressions in a module are evaluated any time a module is imported and always
    run before <code>main</code>, which, only executes if you specifically run that file. if
    you are familiar with static initializers in java, that's what free expressions are. you are
    encouraged to use main when writing anything more than trivial programs.
  </p>
  <h2>Data structures</h2>
  <p>
    in addition to any available java data structures and types, there are a few built-in types
    in loop.
  </p>

  <h3>Strings</h3>
  <p>
    strings in loop are java strings (unicode, utf-16 <code>java.lang.String</code> objects).
    however there are many special loop-specific extensions for working with them. A normal string
    as we've seen before is enclosed in single quotes:
  </p>
  <div class="code">
<pre>print('this is a string of characters')</pre>
  </div>

  <p>
    double quoted strings are also equivalent, but they may contain expressions that are expanded
    at runtime. for example:
  </p>
  <div class="code">
    <pre>greet(name) ->
  print("hello, @{name}")

greet('Dhanji')</pre>
  </div>

  <p>
    running this program prints <code>hello, Dhanji</code> to the console. any loop expression
    can be embedded inside the <i>orb</i> tags - <code>@{}</code>.
  </p>
  <div class="code">
    <pre>"26 * 34 is @{26 * 34}"

=> "26 * 34 is 884"</pre>
  </div>
  <p>
    if you want to print the orb tags literally, fall back to single quoted strings
  </p>
  <div class="code">
    <pre>'this is inside an @{orb tag}'

=> "this is inside an @{orb tag}"</pre>
  </div>

  <h3>Numbers</h3>
  <p>
    loop has built-in support for most common numeric types. the following java types are
    supported natively:
  </p>
  <div>
    <ul class="features">
      <li><img src="../images/arrow_right.png" alt="bullet arrow">Integer (32-bit)</li>
      <li><img src="../images/arrow_right.png" alt="bullet arrow">Long (64-bit)</li>
      <li><img src="../images/arrow_right.png" alt="bullet arrow">Double (64-bit)</li>
      <li><img src="../images/arrow_right.png" alt="bullet arrow">BigInteger (arbitrary)</li>
      <li><img src="../images/arrow_right.png" alt="bullet arrow">BigDecimal (arbitrary)</li>
    </ul>
  </div>
  <p>
    loop has no support for floats, shorts or bytes, however these may be manipulated using java
    primitive wrapper types if needed. by default, any integer appearing in a loop program is
    treated as a 32-bit <code>Integer</code>
  </p>
  <div class="code">
    <pre>print(23.getClass())

=> java.lang.Integer</pre>
  </div>
  <p>
    longs, like in java, are specified by suffixing 'L' to a number. note that unlike java this
    must be an uppercase L.
  </p>
  <div class="code">
    <pre>print(23L.getClass())

=> java.lang.Long</pre>
  </div>
  <p>
    a special syntax is also available for arbitrary precision numbers (numbers too large or too
    precise to fit into 64 bits)
  </p>
  <div class="code">
    <pre>print(@23129038102938102938102938)
print(@2.3129038102938102938102938)

=> 23129038102938102938102938
=> 2.3129038102938102938102938</pre>
  </div>
  <p>
    you can add, subtract, multiply, divide, modulus or compare any two values if they are of the
    same numeric type:
  </p>
  <div class="code">
    <pre>3 + 4
=> 7

46L / 2L
=> 23

@2.0 > @1.9999999999999999
=> true</pre>
  </div>
  <p>
    however, unlike java loop forbids mixing numeric types in expressions. you must convert
    all values to the same, compatible type before computing with them.
  </p>
  <div class="code">
    <pre>\3L + 3\

=> \#error\
</pre>
  </div>

  <p>
    this is done to prevent
    surprising behavior and loss of information when converting between types of different
    precision.
    you can convert any number to the largest precision type easily
  </p>
  <div class="code">
    <pre>@3 + 4.embiggen()
=> 7

@3.0 + 4.0.embiggen()
=> 7.0</pre>
  </div>

  <h3>Operators</h3>
  <p>
    operators in loop are symbols that combine two values to produce a resultant value, for example
    the <code>+</code> (plus) operator adds two numbers and produces their sum. operators need not
    necessarily produce the same type of value as the values they combine. for instance, the
    <code>&gt;</code> (greater-than) operator takes two numbers and returns <code>true</code> if the
    first is greater than the second.
  </p>
  <p>
    the following operators are provided with loop
  </p>
  <div class="code">
    <pre>+, -, /, *, %, >, <, >=, <=, ==, not, and, or</pre>
  </div>
  <p>
    some of these operators work on multiple data types. for instance, the + operator can be used
    to <i>concatenate</i> strings together
  </p>
  <div class="code">
    <pre>'1' + '2'

=> '12'</pre>
  </div>
  <p>
    in fact, as long as the string appears on the left, any object may be concatenated with it
  </p>
  <div class="code">
    <pre>'1' + @2

=> '12'</pre></div>
  <p>
    note that no loop operator ever mutates its operands. it simply reads and
    combines them to produce a third, resultant value. (the assign operator is an exception,
    but we'll deal with that later).
  </p>

  <h3>Lists</h3>

  <p>
    lists are an essential component of programming in loop, as as such they are supported
    natively in syntax. all loop lists are perfectly compatible with <code>java.util.List</code>
    and like <code>String</code>, come with some nifty, loop-specific extensions.
  </p>
  <p>
    lists may contain any (or many) type of object. here is a simple list of integers
  </p>
  <div class="code">
    <pre>[1, 2, 3, 4, 5]</pre></div>
  <p>
    lists are zero-based and can be indexed using familiar brackets syntax - <code>[]</code>
  </p>
  <div class="code">
    <pre>third(ls) ->
  ~ls[2]~

third([1, 2, 3])

=> 3</pre></div>
  <p>
    you can also use a similar syntax to slice portions of lists
  </p>
  <div class="code">
    <pre>pick(ls) ->
  ~ls[0..2]~

pick([1, 2, 3, 4, 5, 6, 7])

=> [1, 2, 3]</pre></div>
  <p>
    leaving out a lower or upper bound slices the list from or to the given index
  </p>
  <div class="code">
    <pre>pick(ls) ->
  ~ls[2..] + ls[..1]~

pick([1, 2, 3, 4])

=> [3, 4, 2, 1]</pre></div>
  <p>
    note that i used the <code>+</code> operator here to add the two sub-lists together. it is
    also sometimes useful to generate lists without typing out each entry. you can use the list
    <code>range</code> syntax to accomplish this:
  </p>
  <div class="code">
    <pre>pick(ls) ->
  ls[0..2]

pick(~[1..7]~)    # generate a list of 1-7

=> [1, 2, 3]</pre></div>
  <p>
    the range syntax is very similar to the slice syntax except that slices must on some existing
    list (in the above cases, a list variable, <code>ls</code>). so keep that in mind when reading
    loop code
  </p>

  <h3>Sets</h3>

  <p>
    similarly, loop provides a natural syntax for working with sets. a set is similar
    to a list except that it is a collection of unique items and that they are present in no
    particular order
  </p>
  <div class="code">
    <pre>~{1, 1, 2, 2, 3, 3}~

=> {1, 2, 3}</pre></div>
  <p>
    loop sets are fully compatible with <code>java.util.Set</code> classes.
  </p>

  <h3>Maps</h3>
  <p>
    maps are an extremely useful data structure. sometimes called <i>hashtables</i> or
    just <i>hashes</i>, a map is basically an collection of key/value pairs.
    they are supported natively by loop and
    created using a familar json-like syntax:
  </p>
  <div class="code">
    <pre>{ 'name' : 'Tyrion',
  'house' : 'Lannister' }

=> { name=Tyrion, house=Lannister }</pre></div>
  <p>
    maps may contain any type or many types as either keys or values
  </p>
  <div class="code">
    <pre>{ 1 : 'one',
 @2 : 'two' }

=> { 1=one, 2=two }</pre></div>
  <p>
    read values out of maps using simple dot syntax (like in json)
  </p>
  <div class="code">
    <pre>{ 'name' : 'Tyrion',
  'house' : 'Lannister' }.~house~ + ' pays his debts'

=> "Lannister pays his debts"</pre></div>
  <p>
    dot syntax can be chained to read from nested maps (maps inside maps) too
  </p>
  <div class="code">
    <pre>~mymap.city.name~

=> "Sydney"</pre></div>
  <p>
    note that the map keys that occur after the '.' must be strings to use this syntax.
  </p>
  <p>
    for keys that are not strings, or not known until runtime, you can use the bracket syntax,
    similar to indexing into a list
  </p>
  <div class="code">
    <pre>read(map, key) ->
  ~map[key]~

read({ 'name' : 'Tyrion'}, 'name')

=> "Tyrion"</pre></div>
  <p>
    here the <code>[key]</code> part tells loop to look for an entry in the map whose value is
    equivalent to the variable, key. later, when we call <code>read()</code>, the variable
    <code>key</code> contains <code>"name"</code> and so prints <code>"Tyrion"</code>
    you can also write to maps, similarly
  </p>
  <div class="code">
    <pre>starkify(map) ->
  ~map.house: 'Stark'~

starkify({ 'name' : 'Tyrion'})

=> { name=Tyrion, house=Stark }</pre></div>
  <p>
    this is the first time we've seen the assign operator <code>':'</code> (interchangeable with
    <code>'='</code>). we'll encounter it a lot more further on but for now, read it as assigning
    the value to the right of the <code>:</code> to the slot represented by its left.
  </p>

  <p>
    like sets and lists, maps are also fully compatible with java's <code>java.util.Map</code>
    type.
  </p>

  <h3>Trees</h3>
  <p>
    like sets are to lists, loop provides a simple syntactic abstraction to represent binary trees.
    a binary tree in loop is also compatible with <code>java.util.Map</code> and is used to
    associate keys to values. its keys are, however, kept in natural sorted order which may be
    realized during iteration. we'll see more about this when looking at list comprehensions.
  </p>
  <div class="code">
    <pre>['Sansa': 'Stark',
'Catelyn': 'Stark',
'Brandon': 'Stark',
'Arya': 'Stark',
'Robb': 'Stark',
'Eddard': 'Stark'].keySet()

=> [ Arya, Brandon, Catelyn, Eddard, Robb, Sansa ]</pre></div>
  <p>
    note that the keys went in in an arbitrary order and when printed produced a sorted result
    according to alphabetical order.
  </p>

  <h3>Symbols</h3>
  <p>
    strings are extremely useful to represent data, however they are somewhat cumbersome to
    represent particular kinds--map keys for example. like ruby, loop ships with support for
    <i>interned</i> strings called symbols. they are more concise to write and perform marginally
    better at runtime
  </p>
  <div class="code">
    <pre>{ @name: 'Tyrion',
  @house: 'Lannister' }</pre></div>
  <p>
    in loop symbols are prefixed with the <code>@</code> character and unlike ruby are
    completely interchangeable with strings
  </p>
  <div class="code">
    <pre>@popsicle == 'pop' + 'sicle'

=> true</pre></div>

  <p>
    all these data types and structures we've learned about can be combined
    to model rich ontologies to suit your needs
  </p>
  <div class="code">
    <pre>{ @houses: { 'Lannister', 'Stark', 'Targaryen' },
  @protagonists: { 'Jon', 'Dany', 'Tyrion' }
  @locations: [ 'Winterfell'   : 'Stark',
                'Targaryen'    : 'Dragonstone',
                'Casterly Rock : 'Lannister' ]}</pre></div>

  <h3>String manipulation</h3>

  <p>
    like lists, loop provides a number of special syntax extensions for working with strings.
    these are just normal java strings. let's look at a few: indexing works with strings exactly
    as it does with lists
  </p>

  <div class="code">
    <pre>'hello'[2]

=> 'l'</pre></div>

  <p>
    note that the object returned is also a string (rather than a <code>java.lang.Character</code>).
    and like lists you can also slice strings
  </p>
  <div class="code">
    <pre>str: 'hello'
print(str[2..4])
print(str[2..])
print(str[..4])

=> ll
=> llo
=> hell</pre></div>

  <p>
    you can also test if a string is a subsequence of another string with the <i>index-of</i>
    syntax
  </p>
  <div class="code">
    <pre>sub?(str, smaller) ->
  str[smaller] > -1

'yellow'.sub?('ell')
'madam im adam'.sub?('mima')
'yellow'['lo']

=> true
=> false
=> 3</pre></div>

  <p>
    these tools make working with strings more declarative and readable, in line with loop's
    functional philosophy.
  </p>

  <h2>Basic expressions</h2>

  <p>
    ok now we're armed with numeric, string and structure types and know a tiny bit about how
    to call functions with arguments. let's delve a bit deeper
  </p>
  <h3>Calling functions</h3>
  <p>
    a function is one of the most basic constructs in loop. a function takes in values
    (called <i>arguments</i>) and returns a single value, always.
    there are no <i>void</i> functions in loop. at runtime, loop functions are compiled directly
    into java functions. you call a loop function by writing its name followed by an argument list
    enclosed in parentheses - <code>()</code>
  </p>
  <div class="code">
    <pre>print('hi')</pre></div>
  <p>
    not all functions have arguments, but the parentheses must always be present:
  </p>
  <div class="code">
    <pre>hi ->
  print('hi')

hi()

=> hi</pre></div>

  <p>
    loop functions can take anything as an argument: numbers, strings, objects, or even other
    functions
  </p>
  <div class="code">
    <pre>meta(func) ->
  func.@call('hi')   # calls print()

meta(print)

=> hi</pre></div>
  <p>
    note the special syntax to call a function. the variable <code>func</code> contains a reference
    to the <code>print()</code> function. to invoke it, we call the special form
    <code>@call</code>, which in turn calls <code>print</code> with its own arguments.
  </p>
  <p>
    a function can be treated like any other value in loop, it can be stored in a variable or
    passed around to other functions as we've just done.
  </p>
  <p>
    as we've seen earlier you can also call methods on java objects. this happens in exactly the
    same way as in java
  </p>
  <div class="code">
    <pre>print('hi'.toUpperCase())

=> HI</pre></div>
  <p>
    here, we're calling the java method <code>String.toUpperCase()</code>, and then passing its
    result to <code>print()</code>. you can call methods on any object in loop this way.
  </p>
  <div class="code">
    <pre>print('hi'.toUpperCase().toLowerCase())
print(22L.intValue())
print(new java.util.Date().getClass().getName())

=> hi
=> 22
=> java.util.Date</pre></div>

  <p>
    loop also provides a form for calling loop functions like you call methods. this is know as the
    <i>call-as-method</i> feature. let's define a simple loop function <code>triple()</code>, that
    takes an integer and multiplies it by 3.
  </p>
  <div class="code">
    <pre>triple(i) ->
  i * 3

triple(2)

=> 6</pre></div>

  <p>
    this is the standard way to call loop functions, but you can also write it like this:
  </p>
  <div class="code">
    <pre>triple(i) ->
  i * 3

2.triple()

=> 6</pre></div>
  <p>
    in this instance we're treating the left hand side of the function as its first argument. you
    can call any loop functions (that are in the current namespace) 'as methods' this way, including
    ones that take multiple arguments
  </p>
  <div class="code">
    <pre>multiply(x, y) ->
  x * y

5.multiply(6)

=> 30</pre></div>
  <p>
    call-as-method provides a nice scheme for 'extending' the functionality of existing
    objects. all these values we've dealt with so far are standard java strings and integers. you
    can even use this form to <i>override</i> existing java methods with your own functionality
  </p>
  <div class="code">
    <pre>toLowerCase(str) ->
  str.toUpperCase()

'hi'.toLowerCase()

=> 'HI'</pre></div>
  <p>
    of course, you'll want to be careful when doing this to avoid confusing yourself later. loop
    provides an escape hatch in case you want to bypass any overrides and ensure that the
    underlying java method is being called.
  </p>
  <div class="code">
    <pre>toLowerCase(str) ->
  str.toUpperCase()

'HI'<-toLowerCase()

=> 'hi'</pre></div>
  <p>
    the <code>'<-'</code> reverse arrow operator signifies that a java method on the object is
    called. you are encouraged to use clear conventions to keep these schemes clear. for instance,
    i like to use the underscore naming convention for loop functions to distinguish them from
    java methods.
  </p>
  <div class="code">
    <pre># loop function
'Now is the winter of our discontent'.to_lower()

# java method
'Now is the summer of our content'.toLowerCase()
</pre></div>
  <p>
    you may instead, prefer to use the <code>'<-'</code> reverse arrow to distinguish them.
  </p>
  <div class="code">
    <pre># loop function
'Now is the winter of our discontent'.toLowerCase()

# java method
'Now is the summer of our content'<-toLowerCase()
</pre></div>

  <p>
    loop doesn't mandate one or the other, and in fact i prefer using the reverse arrow only
    when i want to clarify a potential override.
  </p>

  <h3>Navigating objects</h3>
  <p>
    we've looked at calling functions, now let's look at the values that functions manipulate and
    operate on: objects. all values in loop are compatible with java objects and vice versa. often
    objects are more than just a simple scalar value, they consist of a structure of values--as we
    saw earlier in the case of maps and lists.
  </p>
  <p>
    we saw that maps could be navigated by using the <i>dot syntax</i>, in other words, we can read
    values from the deep structure of the map by specifying a path to the desired slot
  </p>
  <div class="code">
<pre>food: {
  @name: 'Pancake',
  @nutrition: { @calories: 810, @protein: 0.2 }
}

print(~food.nutrition.calories~)

=> 810</pre></div>

  <p>
    in this example, we pick out the <code>calories</code> by specifying a path down the
    <i>graph</i> structure of the map. this should be familiar to you if you've used ruby or python.
    loop provides an identical scheme for navigating all types of objects:
  </p>

  <div class="code">
<pre>now: new java.util.Date()

print(~now.time~)

=> 1335878239084</pre></div>

  <p>
    here, im reading the <code>time</code> property out of a java <code>Date</code> object using
    the same dot-syntax. this 'property', in java, is represented by the pair of methods:
    <code>getTime()</code> and <code>setTime()</code>. the java convention is to declare method
    pairs like this to expose <i>properties</i>.
    (in ruby they are called <i>attribute accessors</i>.)
  </p>
  <p>
    loop will correctly translate this to a java method call as required. let's look at a more
    realistic example
  </p>
  <div class="code">
<pre># java code
public class Person {
  private Person parent;
  private String name;

  public Person getParent() {
    return parent;
  }

  public String getName() {
    return name;
  }

  // etc..
}


# loop code that reads java object
print("Gran's name is")
print(~person.parent.parent.name~)

=> Gran's name is
=> Grantastic E. Gran</pre></div>

  <p>
    the property navigation syntax becomes extremely useful as you write complex programs that
    interact with existing java code and libraries. loop objects can also be navigated similarly,
    as we'll see in the section on <i>classes & objects</i>.
  </p>

  <h3>If/Then/Else</h3>
  <p>
    branching in loop is similar to haskell. because all expressions must produce a value, an
    <i>if-then</i> statement must also have an <i>else</i> clause. the <code>if</code> portion
    takes any boolean expression and
    evaluates the <code>then</code> clause if true, or the <code>else</code> clause if not.
  </p>
  <div class="code">
<pre>if ~3 > 4~ then 'hooray' else 'booray'

=> booray</pre></div>
  <p>
    or more generally:
  </p>
  <div class="code">
<pre>if &lt; boolean &gt; then &lt; expression &gt; else &lt; expression &gt;</pre></div>

  <p>
    the <code>&lt; boolean &gt;</code> part may consist of any expression that results in a
    <code>true</code> or <code>false</code> value. the entire
    statement must generally appear on a single line
  </p>
  <div class="code">
<pre>classify(val) ->
  if val > 1000 then print('big') else print('small')

99.classify()

=> small</pre></div>

  <p>
    but you can split it across multiple lines if the whole expression is wrapped in parentheses
  </p>
  <div class="code">
<pre>classify(val) ->
  (if val < 1000 and val > 100
   then print('middling')
   else print('unknown'))

101.classify()

=> middling</pre></div>

  <p>
    notice I snuck in an <code>and</code> keyword here. you can similarly use <code>or</code> and
    <code>not</code> operators to combine boolean expressions, arithmetically.
  </p>

  <h3>List comprehension</h3>
  <p>
    we've already seen how lists can be sliced and their indexes read. but we can do a lot more
    with them. loop provides a class of expressions known as <i>list comprehensions</i> to quickly
    transform and make sense of lists. comprehensions replace the traditional do-while
    constructs of c and java. take a look
  </p>
  <div class="code">
<pre>i * 2 for i in [1, 2, 3]

=> [2, 4, 6]</pre></div>

  <p>
    here i am saying, for every item in the given list <code>[1, 2, 3]</code>, multiply that item
    by 2. list comprehensions act on any kind of collection (all instances of
    <code>java.util.Collection</code>) and always produce lists of equal or smaller size. for
    example:
  </p>

  <div class="code">
<pre>i for i in [1..10] ~if i % 2 == 0~

=> [1, 3, 5, 7, 9]</pre></div>

  <p>
    here i am <i>filtering</i> the a list of integers from 1 to 10 by whether or not they are odd
    (i.e. <code>i % 2 == 0</code>). the resulting list contains only items that passed the filter.
    you can even combine the filter and transformation expressions
  </p>


  <div class="code">
<pre>~i * 10~ for i in [1..10] ~if i % 2 not 0~

=> [20, 40, 60, 80, 100]</pre></div>

  <p>
    expressed more generally, a list comprehension is
  </p>

  <div class="code">
<pre>< expression > for < var > in < list > [if < filter >]</pre></div>

  <p>
    the first expression is evaluated once for every item in the list that passes the filter. the
    result of that expression is added to the output list. the filter is optional.
  </p>
  <p>
    list comprehensions must also appear on a single line but can be multiline if enclosed in
    parentheses, just like if/then/else expressions.
  </p>

  <h3>Null-safety</h3>
  <p>
    loop is a null-safe language. this means that loop expressions will not throw a
    <code>NullPointerException</code> on receiving null values. there are some exceptions to this,
    but as a general rule, loop strives to acheive a practical reduction of NPEs and the use of
    <code>null</code> in code.
  </p>
  <p>
    since there is no <code>null</code> keyword, in the loop type system, we have what is known as
    a <i>bottom</i> type. if <code>Object</code> is the <i>top</i> type, meaning every type
    inherits from object, then <code>Nothing</code> is the bottom type--meaning that it inherits
    from all types. no types may inherit from <code>Nothing</code>, and there is only one global
    instance of it, which is also referred to as <code>Nothing</code> in code
  </p>

  <div class="code">
<pre>Nothing

=> Nothing</pre></div>

  <p>
    this bit of theory aside, in practical terms you can rest assured that calling a method on
    a <code>Nothing</code> will not break your code--it simply returns <code>Nothing</code> again
  </p>

  <div class="code">
<pre>Nothing.some_method().some_other_method()

=> Nothing

empty: {:}
empty.name

=> Nothing</pre></div>

  <p>
    this even holds for java code that returns <code>null</code>
  </p>

  <div class="code">
<pre>''.getClass().getResource('doesnt_exist').toString()

=> Nothing</pre></div>

  <p>
    if you need to pass <code>null</code> into java apis for some reason, you can use
    <code>Nothing</code> instead
  </p>


  <div class="code">
<pre>person.parent = Nothing
city.setName(Nothing)
j_option_pane.showMessageDialog(Nothing, 'hi there')
# ..</pre></div>

  <p>
    loop will correctly translate this when calling into java, without any performance penalty.
  </p>
  <p>
    of course, loop cannot prevent <code>NullPointerException</code>s from being thrown in java
    code, so code that already does will continue to behave as expected. loop does not try to
    catch and translate them into <code>Nothing</code>s. you will have to handle them as you do
    any other exception (more in the section on <i>control flow</i>).
  </p>
  <p>
    additionally, loop does not permit <code>Nothing</code> in computations. it is a type error to
    attempt to compute with <code>Nothing</code> and this will cause an exception at runtime.
  </p>

  <div class="code">
<pre>1 + \Nothing\

=> \#error\</pre></div>


  <h2>Functions</h2>

  <p>
    we've already been declaring and using functions throughout the examples thus far. let's
    look at them a bit more in depth.
  </p>

  <h3>Sequences</h3>

  <p>
    a function generally takes zero or more arguments and
    returns a value. so far, all the functions have contained only one expression, but sometimes
    this is not sufficient. sometimes you need to do a sequence of things in a go, this is very
    easy:
  </p>
  <div class="code">
    <pre>increment(num) ->
  print(num),
  num + 1

3.increment()

=> 3
=> 4</pre></div>

  <p>
    here, we're executing two expressions in sequence, first we print the value of the number,
    then we return the number plus 1. a sequence may contain as many expressions as you need
  </p>

  <div class="code">
    <pre>do_stuff() ->
  print('hit any key to continue...'),
  pause(),
  print('no, hit the ANY key to continue...'),
  pause(),
  print('done!')

=> hit any key to continue...
=> no, hit the ANY key to continue...
=> done!</pre></div>

  <p>
    note that the last expression must not end in a comma. haskell programmers may be familiar
    with this as a <i>do block</i>, and for schemers, this is the equivalent of a <code>begin</code>
    sequence. however, unlike haskell, in loop a sequence is guaranteed to execute in order.
  </p>

  <h3>Local scope</h3>

  <p>
    it is often useful to define a set of values and functions specifically for a purpose. loop
    provides a lightweight and simple system to accomplish this (this should be familar for
    haskell programmers)
  </p>

  <div class="code">
    <pre>minutes_in(num) ->
  num * year
  where
    hour: 60
    day : 24 * hour
    week: 7 * day
    year: 52 * week

print("there are @{minutes_in(2)} minutes in 2 years")

=> there are 1048320 minutes in 2 years</pre></div>

  <p>
    the <i>local</i> variables <code>hour, day, week, year</code> are only available inside the
    scope of the <code>minutes_in()</code> function.
  </p>

  <div class="code">
    <pre>minutes_in(num) ->
  num * year
  where
    hour: 60
    day : 24 * hour
    week: 7 * day
    year: 52 * week

print(\year\)

=> \#error\</pre></div>

  <p>
    you can even declare functions in local scope this way
  </p>
  <div class="code">
    <pre>initials(name) ->
  first(words[0]) + first(words[1])
  where
    words: split(name)
    ~first(word) ->~
      if word.isEmpty() then '' else word[0]

initials('Theon Greyjoy')

=> 'TG'

\first\('Elric')

=> \#error\</pre></div>

  <p>
    here the function <code>first()</code> is scoped locally to the parent function
    <code>initials()</code>. it's useful to save duplicating code within the parent function,
    but not needed elsewhere so it goes out of scope
  </p>
  <p>
    locally scoped functions can also have local scopes of their own. there is no limit to the
    nesting depth. so please use it wisely
  </p>

  <div class="code">
    <pre>minutes_in(num) ->
  yearify(num)
  where
    yearify(num) ->
      weekify(num)
      where
        weekify(num) ->
          dayify(num)
          where
            ...
    </pre></div>

  <h3>Module scope</h3>
  <p>
    by default all top-level functions in loop are public. that means any function that is
    not part of a <i>where</i> block of another function is visible to (and callable from)
    all other parts of the program. now, local-scope is useful for helper functions that are
    private to a single function, but what if you want to share helpers <i>between</i> top-level
    functions?
  </p>
  <p>
    loop provides a third scope known as <i>module scope</i> for exactly this purpose. functions
    scoped to the module level are visible to all other parts of the same module, but nowhere
    else. in this way you can reuse important blocks of code easily, and still hide unnecessary
    implementation details by sectioning them off from other parts of your app.
  </p>
  <div class="code">
    <pre>@last(ls) ->
  ls[ls.length() - 1]

func1 ->
  [1, 2, 3].@last()

func2 ->
  [30, 20, 10].@last()

=> 3
=> 10

# a different module
func3 ->
  [10, 20].\@last()\

=> \#error\ </pre></div>

  <p>
    you declare a function as module-scoped by simply prefixing its name with <code>@</code>.
    loop will ensure that this function is restricted to the current module. note that this is
    not merely a naming convention: <code>@</code>-prefixed functions have their visibility
    enforced by the runtime.
  </p>

  <h3>Closures</h3>

  <p>
    closures, or anonymous functions, are quite useful in a language like loop where functions
    are a first-class construct. because they can be held in variables and passed around, it is
    sometimes useful to create small blocks of functionality that aren't necessarily declared
    as top-level or scoped functions. these are called closures
  </p>

  <div class="code">
    <pre>manipulate(ls, func) ->
  func.@call(i) for i in ls

manipulate([1, 2, 3], @(x) ->
                        x * 5)

=> [5, 10, 15]</pre></div>

  <p>
    in this example, i am passing a code block in the form of an anonymous function
    (<code>@</code>-sign followed by an argument list and <code>-></code> arrow) to the
    meta-function <code>manipulate()</code>, which, takes a list of items and calls the given
    function for each item in the list.
  </p>

  <p>
    the nice thing about closures is that they can refer to values in scope at the time of their
    creation long after the scope is lost
  </p>

  <div class="code">
    <pre>make(num) ->
  @() ->
    print(num)

make(10).@call()

=> 10</pre></div>

  <h2>Pattern matching</h2>

  <p>
    so far we've looked at simple functions and sequences--functions that essentially contain a
    single expression to manipulate and respond to input values. this is well and good for a lot
    of use cases, but loop provides a more powerful, declarative construct called pattern matching.
  </p>

  <p>
    pattern matching in loop is inspired by the same idea in haskell and closely mirrors the
    latter's concepts. when used properly, pattern matching can be extremely powerful, giving you
    concise, elegant programs that read like a solution rather than a process to follow.
  </p>

  <p>
    pattern matching functions in loop are denoted by a <code>=></code> arrow and embody one or
    more <i>pattern rules</i> that follow
  </p>
  <div class="code">
    <pre>speak(num) =>
  1   : 'one'
  2   : 'two'

speak(2)

=> 2</pre></div>

  <p>
    this is a naively simple pattern matching function that tests if the value passed in is either
    1 or 2 and returns the appropriate string. note that it reads like a table of mappings between
    inputs and outputs. this is much nicer to work with than the equivalent simple function
  </p>

  <div class="code">
    <pre>speak(num) ->
  if num == 1 then 'one' else (if num == 2
                               then 'two' else ...)

speak(2)

=> 2</pre></div>

  <p>
    notice also that we don't have a rule for values other than 1 or 2. what happens if we call
    the pattern matching version of <code>speak()</code> with 3?
  </p>

  <div class="code">
    <pre>speak(num) =>
  1   : 'one'
  2   : 'two'

speak(\ 3\ )

=> \#error: Non-exhaustive pattern rules\</pre></div>

  <p>
    since there is no behavior specified, loop objects to this value being passed in to
    <code>speak()</code>. now, this is fine for 3 but what about every other value we haven't
    specified? in the simple if/then case we can handle this with an additional <code>else</code>,
    however in pattern matching we can use a <i>wildcard</i> rule
  </p>

  <div class="code">
    <pre>speak(num) =>
  1   : 'one'
  2   : 'two'
  *   : 'other'

speak(3)

=> other</pre></div>

  <p>
    the asterisk - <code>*</code> denotes any value, and is matched last, if all the other rules
    fail.
  </p>

  <section id="copyright">&copy; 2012 by <a href="http://rethrick.com/about">Dhanji R. Prasanna</a>.
    Some rights reserved.</section>
</section>
</body>
</html>
